<!doctype html><html class="no-js" lang="en" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#15a"><title>Your appsettings.json Is a Compliance Violation — Daily DevOps & .NET</title><meta name="description" content="Hardcoded secrets aren&rsquo;t just bad practice—they&rsquo;re ISO 27017 violations with real consequences: failed audits, denied insurance claims, contractual …"><meta name="twitter:description" property="og:description" content="Hardcoded secrets aren&rsquo;t just bad practice—they&rsquo;re ISO 27017 violations with real consequences: failed audits, denied insurance claims, contractual …"><meta name="author" content="Martin Stühmer"><link rel="icon" href="/logo.svg?v=b9e294dc5c6fa04439c8c803d8e981a9" sizes="any" type="image/svg+xml"><meta name="twitter:title" property="og:title" content="Your appsettings.json Is a Compliance Violation — Daily DevOps & .NET"><meta property="og:updated_time" content="2026-02-03T17:06:04+01:00"><meta property="article:modified_time" content="2026-02-03T17:06:04+01:00"><meta property="article:published_time" content="2026-02-03T17:00:00+01:00"><meta property="og:type" content="article"><meta property="og:site_name" content="Daily DevOps & .NET"><meta property="og:url" content="https://daily-devops.net/posts/secrets-management-azure-keyvault/"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" name="twitter:image" content="https://daily-devops.net/images/security-1200x630.webp?v=23a02c90b4722e133963cc7c0a010b71"><meta property="og:image:secure_url" content="https://daily-devops.net/images/security-1200x630.webp?v=23a02c90b4722e133963cc7c0a010b71"><meta property="og:image:alt" name="twitter:image:alt" content="Your appsettings.json Is a Compliance Violation"><meta property="og:image:type" content="image/webp"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image" name="twitter:image" content="https://daily-devops.net/images/security-1200x630.png?v=c25b02c29e701934a389f13185e3526a"><meta property="og:image:secure_url" content="https://daily-devops.net/images/security-1200x630.png?v=c25b02c29e701934a389f13185e3526a"><meta property="og:image:alt" name="twitter:image:alt" content="Your appsettings.json Is a Compliance Violation"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><link rel="dns-prefetch" href="https://www.clarity.ms"><link rel="preconnect" href="https://www.clarity.ms" crossorigin><link rel="stylesheet" href="/css/style.min.0b2ef4378cd908eb695017aaa74603d244ff2b38c8068b4b51d76cad830c8ee5e3a40b67ab5b860a542c8bae73d8ba90cfbe9249b59c733a50de74cc32af818a.css" integrity="sha512-Cy70N4zZCOtpUBeqp0YD0kT/KzjIBotLUddsrYMMjuXjpAtnq1uGClQsi65z2LqQz76SSbWcczpQ3nTMMq+Big==" crossorigin="anonymous"><link rel="alternate" href='https://daily-devops.net/posts/secrets-management-azure-keyvault/' hreflang="x-default" title="Your appsettings.json Is a Compliance Violation &mdash; Daily DevOps & .NET"><link rel="canonical" href="https://daily-devops.net/posts/secrets-management-azure-keyvault/" hreflang="en" title="Your appsettings.json Is a Compliance Violation &mdash; Daily DevOps & .NET"><link rel="home" href="https://daily-devops.net/" hreflang="en" title="Daily DevOps & .NET"><link rel="next" href="https://daily-devops.net/posts/storage-architecture-stateful-workloads-aks/" hreflang="en" title="Storage Architecture & Stateful Workloads in AKS"><link rel="prev" href="https://daily-devops.net/posts/audit-logging-azure-app-insights/" hreflang="en" title="Audit Logging That Survives Your Next Security Incident"><link rel="author" href="https://daily-devops.net/authors/martin/" hreflang="en" title="Martin Stühmer &mdash; Daily DevOps & .NET"><meta name="giscus:backlink" content="https://daily-devops.net/posts/secrets-management-azure-keyvault/"><script defer src="/js/above.min.cb42b2c9a453e49e278326637d72d2f01e7f32e3f91e9cdde8fb587793d05514efd2f5cc5021c9658ca0f73876dbdcd1f7cb4a37c0bebc9df01110926b6d7cba.js" integrity="sha512-y0KyyaRT5J4ngyZjfXLS8B5/MuP5Hpzd6PtYd5PQVRTv0vXMUCHJZYyg9zh229zR98tKN8C+vJ3wERCSa218ug==" crossorigin="anonymous"></script><script type="text/javascript">(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","o0pr4n9gg3")</script><script src="https://analytics.ahrefs.com/analytics.js" data-key="C5Iv+2Rb9el+FLJqVw2QGA" async></script></head><body class="container"><header class="header"><a class="logo" href="/" title="Daily DevOps & .NET" rel="home"><figure class="page-logo"><picture><img src="/logo.svg?v=b9e294dc5c6fa04439c8c803d8e981a9" alt="Daily DevOps & .NET" title="Daily DevOps & .NET"></picture></figure><span class="title">Daily DevOps & .NET</span></a><nav class="menu" aria-label="Main navigation"><button class="burger" type="button" aria-haspopup="menu" aria-expanded="false" aria-label="Toggle menu">
<i class="fas fa-burger" aria-hidden="true"></i></button><ul class="navigation"><li class="active"><a href="/posts/">Posts</a></li><li><a href="/authors/">About us</a></li></ul></nav><div class="divider"></div></header><main class="body"><figure class="hero"><picture><source srcset="/images/security-544x136.webp?v=bfca7afe6fd8a89b9abc2e6578377ecd" type="image/webp" media="(max-width: 575.98px)"><source srcset="/images/security-544x136.png?v=a11669f57e90374669cb0babb25f5dbd" type="image/png" media="(max-width: 575.98px)"><source srcset="/images/security-672x168.webp?v=62a10e076f01e08d890102aa4e02ef93" type="image/webp" media="(max-width: 767.98px)"><source srcset="/images/security-672x168.png?v=663fb88cff6268534d435ce8ba0b3ee0" type="image/png" media="(max-width: 767.98px)"><source srcset="/images/security-896x224.webp?v=7d4031888869a0df21996cf3fa43c47e" type="image/webp" media="(max-width: 991.98px)"><source srcset="/images/security-896x224.png?v=1d4fafee73dde51bc042c4b668d3c0e7" type="image/png" media="(max-width: 991.98px)"><source srcset="/images/security-1104x276.webp?v=e674c46b67ccbd2bb5466b95f11f41f6" type="image/webp" media="(max-width: 1199.98px)"><source srcset="/images/security-1104x276.png?v=4c7fb78837d783fc30f62e069d44945f" type="image/png" media="(max-width: 1199.98px)"><source srcset="/images/security-1444x361.webp?v=eb0adef2553eb5c47b56f0ed044eacd0" type="image/webp"><source srcset="/images/security-1444x361.png?v=1338349ed2f41119c662cbd6151058f9" type="image/png"><img src="/images/security.png?v=530c4f0b5995d08df3450423fd03c5e0" alt="Your appsettings.json Is a Compliance Violation" loading="lazy" decoding="async" title="Your appsettings.json Is a Compliance Violation"></picture></figure><article class="post"><header><h1>Your appsettings.json Is a Compliance Violation</h1></header><section class="content" role="region"><p>Last week I reviewed a client&rsquo;s .NET application destined for an enterprise Azure deployment. Connection strings sat in plain text in <code>appsettings.Production.json</code>. API keys for payment processors right alongside them. Both committed to GitHub—publicly visible for three months before anyone noticed.</p><p>This wasn&rsquo;t negligence. It was the predictable outcome of teams that never learned <em>why</em> secrets management matters beyond &ldquo;it&rsquo;s a best practice.&rdquo; They&rsquo;d seen the Azure Key Vault docs. But when deadlines hit, they defaulted to the easiest approach: just put it in the config file.</p><p>What they didn&rsquo;t understand is that secrets in configuration files aren&rsquo;t just a security anti-pattern. They&rsquo;re a fundamental violation of ISO/IEC 27017—the international standard governing cloud security controls. And that violation has real consequences: failed audits, denied insurance claims, contractual penalties.</p><h2 id="what-iso-27017-actually-requires"><a href="/posts/secrets-management-azure-keyvault/#what-iso-27017-actually-requires" title="What ISO 27017 Actually Requires">What ISO 27017 Actually Requires</a></h2><p>ISO/IEC 27017 extends the foundational ISO 27001 framework with cloud-specific guidance. Control CLD 10.1.2 addresses cryptographic key management directly—and it impacts every .NET application handling production secrets.</p><p>The standard doesn&rsquo;t prescribe specific technologies. It defines control objectives. For secrets management, CLD 10.1.2 requires:</p><ol><li><strong>Cryptographic keys protected throughout their lifecycle</strong>—generation, distribution, storage, rotation, destruction.</li><li><strong>Clear responsibility delineation</strong> between cloud provider and customer.</li><li><strong>Least-privilege access</strong> with explicit authorization policies.</li></ol><p>Parent controls A.10.1.1 (Policy on cryptographic controls) and A.10.1.2 (Key management) from ISO 27001 complete the framework: organizations must define cryptographic policies, implement key management procedures, and maintain audit trails for every key access.</p><p>I&rsquo;ve watched teams treat these as abstract compliance checkboxes—something for the security team to worry about, not developers. That&rsquo;s a fundamental misunderstanding. These controls translate directly into engineering requirements. Every line of code that touches a secret either satisfies them or violates them. There&rsquo;s no middle ground.</p><h2 id="the-shared-responsibility-boundary"><a href="/posts/secrets-management-azure-keyvault/#the-shared-responsibility-boundary" title="The Shared Responsibility Boundary">The Shared Responsibility Boundary</a></h2><p>Here&rsquo;s where teams consistently get confused: Azure Key Vault creates a shared responsibility boundary for cryptographic key protection. Understanding this boundary isn&rsquo;t optional—it&rsquo;s essential for compliance.</p><p><strong>Microsoft&rsquo;s responsibility</strong> (as cloud service provider):</p><ul><li>Physical security of hardware security modules (HSMs)</li><li>Encryption of secrets at rest within the vault</li><li>Network isolation and DDoS protection for the Key Vault service</li><li>Patch management and security updates</li><li>SOC 2, ISO 27001, ISO 27017 certification of service infrastructure</li></ul><p><strong>Your responsibility</strong> (as cloud service customer):</p><ul><li>Access policies defining who and what can retrieve secrets</li><li>Network access rules restricting which systems can reach your vault</li><li>Rotation policies ensuring secrets don&rsquo;t remain static indefinitely</li><li>Monitoring and alerting for suspicious access patterns</li><li>Secure retrieval patterns that don&rsquo;t expose secrets in logs or memory dumps</li></ul><p>When my client&rsquo;s <code>appsettings.Production.json</code> contained plaintext connection strings, they hadn&rsquo;t just made a poor technical choice. They had assumed responsibility for <em>all</em> cryptographic protection of those credentials—protection they had no capability to provide. No HSM. No encryption at rest. No access auditing. No rotation procedures. No audit trail.</p><p>That&rsquo;s not a minor oversight. That&rsquo;s a compliance gap wide enough to drive an audit finding through. And auditors <em>will</em> find it.</p><h2 id="the-fatal-pattern-secrets-in-configuration"><a href="/posts/secrets-management-azure-keyvault/#the-fatal-pattern-secrets-in-configuration" title="The Fatal Pattern: Secrets in Configuration">The Fatal Pattern: Secrets in Configuration</a></h2><p>Let me show you exactly what compliance failure looks like. This pattern appears in far too many production applications I&rsquo;ve reviewed:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="c1">// appsettings.Production.json - The compliance disaster
</span></span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;ConnectionStrings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Database&#34;</span><span class="p">:</span> <span class="s2">&#34;Server=prod-sql.database.windows.net;Database=OrdersDB;User Id=app_user;Password=SuperSecretP@ssw0rd123;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;PaymentGateway&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;ApiKey&#34;</span><span class="p">:</span> <span class="s2">&#34;pk_live_1234567890&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;WebhookSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;whsec_abcdef123456&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Every line of that configuration file represents a compliance violation:</p><p><strong>CLD 10.1.2 violation</strong>: Cryptographic keys stored without HSM protection, without access controls, without lifecycle management. The storage account key sits there in plain text, accessible to anyone who can read the file.</p><p><strong>A.10.1.1 violation</strong>: No cryptographic policy governs how these secrets are protected. They&rsquo;re just&mldr; there. Committed to source control. Deployed to servers. Copied between environments.</p><p><strong>A.10.1.2 violation</strong>: No key management procedure exists. When was that database password last rotated? Who has access to it? What happens when an employee leaves? Nobody knows, because nobody tracked it.</p><p>The violations compound when you consider the full deployment pipeline. Secrets echoed to CI/CD logs. Shared in Slack channels (&ldquo;Hey, I need the production API key for debugging&rdquo;). Copy-pasted between environments. Stored in plain text on developer laptops.</p><p>This cascade of failures doesn&rsquo;t stem from incompetence or malice. It stems from teams that never understood the <em>control objectives</em> behind secrets management. They know secrets in code are &ldquo;bad,&rdquo; but they don&rsquo;t understand <em>why</em>—so when shortcuts become convenient, they take them.</p><h2 id="the-compliant-pattern-azure-key-vault-with-managed-identity"><a href="/posts/secrets-management-azure-keyvault/#the-compliant-pattern-azure-key-vault-with-managed-identity" title="The Compliant Pattern: Azure Key Vault with Managed Identity">The Compliant Pattern: Azure Key Vault with Managed Identity</a></h2><p>Now let me show you what compliance actually looks like. Not just &ldquo;better security&rdquo;—actual ISO 27017 control satisfaction:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="n">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// In production, use Managed Identity to authenticate to Key Vault</span>
</span></span><span class="line"><span class="cl"><span class="c1">// In development, DefaultAzureCredential falls back to Azure CLI or Visual Studio</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(!</span><span class="n">builder</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="n">IsDevelopment</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">keyVaultUri</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="s">$&#34;https://{builder.Configuration[&#34;</span><span class="n">KeyVaultName</span><span class="s">&#34;]}.vault.azure.net/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">AddAzureKeyVault</span><span class="p">(</span><span class="n">keyVaultUri</span><span class="p">,</span> <span class="k">new</span> <span class="n">DefaultAzureCredential</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The <code>DefaultAzureCredential</code> class deserves attention. It implements a credential chain that automatically selects the appropriate authentication method based on execution environment: Managed Identity for Azure-hosted workloads, Visual Studio credentials for local development, Azure CLI for command-line scenarios. Your code never contains credentials for accessing Key Vault itself—the identity <em>is</em> the authentication. No secrets to manage for accessing the secret store.</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">// Strongly-typed configuration with validation</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">sealed</span> <span class="k">class</span> <span class="nc">DatabaseOptions</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="na">    [Required]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">string</span> <span class="n">ConnectionString</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">sealed</span> <span class="k">class</span> <span class="nc">PaymentGatewayOptions</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="na">    [Required]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">string</span> <span class="n">ApiKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">    [Required]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">string</span> <span class="n">WebhookSecret</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Registration with startup validation - fail fast if secrets are missing</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddOptionsWithValidateOnStart</span><span class="p">&lt;</span><span class="n">DatabaseOptions</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">BindConfiguration</span><span class="p">(</span><span class="s">&#34;Database&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddOptionsWithValidateOnStart</span><span class="p">&lt;</span><span class="n">PaymentGatewayOptions</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">BindConfiguration</span><span class="p">(</span><span class="s">&#34;PaymentGateway&#34;</span><span class="p">);</span>
</span></span></code></pre></div><p>Key Vault secrets map to configuration paths using <code>--</code> as separator (colons aren&rsquo;t valid in secret names):</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Database--ConnectionString     →  Database:ConnectionString
</span></span><span class="line"><span class="cl">PaymentGateway--ApiKey         →  PaymentGateway:ApiKey
</span></span><span class="line"><span class="cl">PaymentGateway--WebhookSecret  →  PaymentGateway:WebhookSecret
</span></span></code></pre></div><p>This naming convention means your existing <code>IConfiguration</code>-based code doesn&rsquo;t need to change. The secrets appear in the configuration hierarchy exactly where your code expects them.</p><h2 id="implementing-least-privilege-access-policies"><a href="/posts/secrets-management-azure-keyvault/#implementing-least-privilege-access-policies" title="Implementing Least-Privilege Access Policies">Implementing Least-Privilege Access Policies</a></h2><p>ISO 27017 control CLD 10.1.2 requires that access to cryptographic keys follow least-privilege principles. Too many teams interpret this as &ldquo;use Azure AD authentication&rdquo; and call it done. That&rsquo;s not least-privilege—that&rsquo;s just <em>authentication</em>.</p><p>Azure Key Vault implements true least-privilege through Azure RBAC:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bicep" data-lang="bicep"><span class="line"><span class="cl"><span class="kd">resource</span><span class="w"> </span><span class="nv">keyVault</span><span class="w"> </span><span class="s">&#39;Microsoft.KeyVault/vaults@2023-07-01&#39;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="nv">keyVaultName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">location</span><span class="p">:</span><span class="w"> </span><span class="nv">location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">properties</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">tenantId</span><span class="p">:</span><span class="w"> </span><span class="nf">subscription</span><span class="p">().</span><span class="nv">tenantId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">sku</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">family</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;standard&#39;</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Use Azure RBAC instead of legacy access policies</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">enableRbacAuthorization</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Compliance requirements: soft-delete and purge protection</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">enableSoftDelete</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">softDeleteRetentionInDays</span><span class="p">:</span><span class="w"> </span><span class="nv">90</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">enablePurgeProtection</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Network restrictions - deny by default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">networkAcls</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nv">defaultAction</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Deny&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nv">bypass</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AzureServices&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Application identity gets ONLY &#34;Secrets User&#34; - read secrets, nothing else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">resource</span><span class="w"> </span><span class="nv">appSecretsRole</span><span class="w"> </span><span class="s">&#39;Microsoft.Authorization/roleAssignments@2022-04-01&#39;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="nf">guid</span><span class="p">(</span><span class="nv">keyVault</span><span class="p">.</span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">appIdentity</span><span class="p">.</span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Key Vault Secrets User&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">scope</span><span class="p">:</span><span class="w"> </span><span class="nv">keyVault</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">properties</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">roleDefinitionId</span><span class="p">:</span><span class="w"> </span><span class="nf">subscriptionResourceId</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#39;Microsoft.Authorization/roleDefinitions&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#39;4633458b-17de-408a-b874-0445c86b69e6&#39;</span><span class="w">  </span><span class="c1">// Key Vault Secrets User</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">principalId</span><span class="p">:</span><span class="w"> </span><span class="nv">appIdentity</span><span class="p">.</span><span class="nv">properties</span><span class="p">.</span><span class="nv">principalId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">principalType</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ServicePrincipal&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Notice the deliberate role separation:</p><ul><li><strong>Applications</strong> receive <code>Key Vault Secrets User</code>—they can read secrets, nothing else. No listing, no management, no deletion.</li><li><strong>Operations teams</strong> receive <code>Key Vault Secrets Officer</code>—they can manage secrets but not vault configuration.</li><li><strong>Security administrators</strong> receive <code>Key Vault Administrator</code>—full control, assigned sparingly and with justification.</li></ul><p>This separation satisfies ISO 27017&rsquo;s requirement for explicit authorization policies. Every access is attributable to a specific identity. That&rsquo;s the audit trail compliance demands—and auditors will check.</p><h2 id="soft-delete-and-purge-protection"><a href="/posts/secrets-management-azure-keyvault/#soft-delete-and-purge-protection" title="Soft-Delete and Purge Protection">Soft-Delete and Purge Protection</a></h2><p>Two Key Vault features directly address ISO 27017 control A.10.1.2 requirements for key lifecycle management. I&rsquo;ve seen teams skip these &ldquo;because we&rsquo;re careful&rdquo;—and then watched them panic when an automated script accidentally purged production secrets.</p><p><strong>Soft-delete</strong> ensures deleted secrets aren&rsquo;t immediately destroyed. They enter a recoverable state for a configurable retention period (7-90 days). This protects against accidental deletion by operators, malicious deletion by compromised accounts, and recovery needs during incident response.</p><p><strong>Purge protection</strong> prevents even Key Vault administrators from permanently destroying secrets during the retention period. Once enabled, purge protection cannot be disabled—a deliberate design choice that protects the audit trail. You can&rsquo;t cover your tracks if you can&rsquo;t destroy the evidence.</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">sealed</span> <span class="k">class</span> <span class="nc">KeyVaultHealthCheck</span> <span class="p">:</span> <span class="n">IHealthCheck</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">readonly</span> <span class="n">SecretClient</span> <span class="n">_secretClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">KeyVaultHealthCheck</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">KeyVaultHealthCheck</span><span class="p">(</span><span class="n">SecretClient</span> <span class="n">secretClient</span><span class="p">,</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">KeyVaultHealthCheck</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_secretClient</span> <span class="p">=</span> <span class="n">secretClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">HealthCheckResult</span><span class="p">&gt;</span> <span class="n">CheckHealthAsync</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">HealthCheckContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">ct</span> <span class="p">=</span> <span class="k">default</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Verify we can reach Key Vault and have appropriate permissions</span>
</span></span><span class="line"><span class="cl">            <span class="k">await</span> <span class="n">_secretClient</span><span class="p">.</span><span class="n">GetPropertiesOfSecretsAsync</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">AsPages</span><span class="p">(</span><span class="n">pageSizeHint</span><span class="p">:</span> <span class="m">1</span><span class="p">).</span><span class="n">FirstAsync</span><span class="p">(</span><span class="n">ct</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">HealthCheckResult</span><span class="p">.</span><span class="n">Healthy</span><span class="p">(</span><span class="s">&#34;Key Vault connection verified&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="p">(</span><span class="n">RequestFailedException</span> <span class="n">ex</span><span class="p">)</span> <span class="n">when</span> <span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="m">403</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_logger</span><span class="p">.</span><span class="n">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#34;Key Vault access denied - check Managed Identity role assignment&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">HealthCheckResult</span><span class="p">.</span><span class="n">Unhealthy</span><span class="p">(</span><span class="s">&#34;Key Vault access denied - RBAC misconfiguration&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_logger</span><span class="p">.</span><span class="n">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#34;Key Vault health check failed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">HealthCheckResult</span><span class="p">.</span><span class="n">Unhealthy</span><span class="p">(</span><span class="s">&#34;Key Vault unavailable&#34;</span><span class="p">,</span> <span class="n">ex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This health check catches configuration errors before they become production incidents. Deploy to a new environment with a misconfigured Managed Identity? The health check fails immediately, before users hit the application.</p><h2 id="github-actions-without-secret-exposure"><a href="/posts/secrets-management-azure-keyvault/#github-actions-without-secret-exposure" title="GitHub Actions Without Secret Exposure">GitHub Actions Without Secret Exposure</a></h2><p>CI/CD pipelines are a frequent source of secret leakage—and ISO 27017 compliance extends to your deployment infrastructure. I&rsquo;ve reviewed pipelines where developers echo environment variables to logs &ldquo;for debugging,&rdquo; permanently exposing production credentials in build history.</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Deploy to Azure</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">main]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nt">permissions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l">write </span><span class="w"> </span><span class="c"># Required for OIDC - no long-lived secrets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l">read</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l">production </span><span class="w"> </span><span class="c"># Requires approval for production deploys</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Azure Login via OIDC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">azure/login@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># These are NOT secrets - they&#39;re identifiers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">client-id</span><span class="p">:</span><span class="w"> </span><span class="l">${{ vars.AZURE_CLIENT_ID }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">tenant-id</span><span class="p">:</span><span class="w"> </span><span class="l">${{ vars.AZURE_TENANT_ID }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">subscription-id</span><span class="p">:</span><span class="w"> </span><span class="l">${{ vars.AZURE_SUBSCRIPTION_ID }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">dotnet publish -c Release -o ./publish</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Deploy to App Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">azure/webapps-deploy@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">app-name</span><span class="p">:</span><span class="w"> </span><span class="l">${{ vars.APP_SERVICE_NAME }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="l">./publish</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># App Service retrieves secrets from Key Vault via Managed Identity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># No secrets pass through this pipeline - ever</span><span class="w">
</span></span></span></code></pre></div><p>The key principles here matter:</p><ol><li><strong>OIDC authentication</strong> eliminates long-lived service principal secrets. The workflow requests a short-lived token for each run.</li><li><strong>Secrets never appear in workflow logs</strong>—use <code>vars</code> for non-sensitive configuration, never echo values.</li><li><strong>Managed Identity handles Key Vault access</strong>—the deployment pipeline doesn&rsquo;t need to know production secrets.</li><li><strong>Environment protection rules</strong> require approval for production deployments, creating an audit trail.</li></ol><h2 id="automatic-key-rotation"><a href="/posts/secrets-management-azure-keyvault/#automatic-key-rotation" title="Automatic Key Rotation">Automatic Key Rotation</a></h2><p>ISO 27017 control A.10.1.2 requires key lifecycle management, including rotation. &ldquo;We&rsquo;ll rotate it when we remember&rdquo; isn&rsquo;t a rotation policy—it&rsquo;s a prayer. Key Vault supports automatic rotation for certain secret types:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bicep" data-lang="bicep"><span class="line"><span class="cl"><span class="kd">resource</span><span class="w"> </span><span class="nv">rotationPolicy</span><span class="w"> </span><span class="s">&#39;Microsoft.KeyVault/vaults/secrets/rotationPolicies@2023-07-01&#39;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">parent</span><span class="p">:</span><span class="w"> </span><span class="nv">storageKeySecret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;default&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nv">properties</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">rotationPolicy</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nv">lifetimeActions</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nv">trigger</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">timeAfterCreate</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;P60D&#39;</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// 60 days after creation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nv">action</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Rotate&#39;</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nv">trigger</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">timeBeforeExpiry</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;P30D&#39;</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// 30 days before expiry</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nv">action</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Notify&#39;</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nv">attributes</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">expiryTime</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;P90D&#39;</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// Secret expires after 90 days</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>For secrets that can&rsquo;t be automatically rotated—third-party API keys, legacy system credentials—implement monitoring to track age. Don&rsquo;t rely on humans remembering:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">sealed</span> <span class="k">class</span> <span class="nc">SecretExpirationMonitor</span> <span class="p">:</span> <span class="n">BackgroundService</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">readonly</span> <span class="n">SecretClient</span> <span class="n">_secretClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">SecretExpirationMonitor</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">readonly</span> <span class="n">TimeSpan</span> <span class="n">_warningThreshold</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromDays</span><span class="p">(</span><span class="m">30</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">SecretExpirationMonitor</span><span class="p">(</span><span class="n">SecretClient</span> <span class="n">secretClient</span><span class="p">,</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">SecretExpirationMonitor</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_secretClient</span> <span class="p">=</span> <span class="n">secretClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">ExecuteAsync</span><span class="p">(</span><span class="n">CancellationToken</span> <span class="n">stoppingToken</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">timer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PeriodicTimer</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromHours</span><span class="p">(</span><span class="m">24</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="k">await</span> <span class="n">timer</span><span class="p">.</span><span class="n">WaitForNextTickAsync</span><span class="p">(</span><span class="n">stoppingToken</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">await</span> <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">secret</span> <span class="k">in</span> <span class="n">_secretClient</span><span class="p">.</span><span class="n">GetPropertiesOfSecretsAsync</span><span class="p">(</span><span class="n">stoppingToken</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">secret</span><span class="p">.</span><span class="n">ExpiresOn</span><span class="p">.</span><span class="n">HasValue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="kt">var</span> <span class="n">timeUntilExpiry</span> <span class="p">=</span> <span class="n">secret</span><span class="p">.</span><span class="n">ExpiresOn</span><span class="p">.</span><span class="n">Value</span> <span class="p">-</span> <span class="n">DateTimeOffset</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="n">timeUntilExpiry</span> <span class="p">&lt;=</span> <span class="n">_warningThreshold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">_logger</span><span class="p">.</span><span class="n">LogWarning</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                            <span class="s">&#34;Secret {SecretName} expires in {Days} days. Rotation required.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">secret</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">timeUntilExpiry</span><span class="p">.</span><span class="n">Days</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// Integration point: send alert to ops team, create ticket, etc.</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="from-configuration-files-to-compliance"><a href="/posts/secrets-management-azure-keyvault/#from-configuration-files-to-compliance" title="From Configuration Files to Compliance">From Configuration Files to Compliance</a></h2><p>The path from <code>appsettings.Production.json</code> to ISO 27017 compliance isn&rsquo;t just about moving secrets to Key Vault. It requires a fundamental shift in how teams think about credential management:</p><p><strong>Secrets are not configuration.</strong> They require dedicated infrastructure with access controls, rotation policies, and audit trails. Treating them as configuration values—even encrypted configuration values—misses the point entirely. Configuration tells your application <em>how</em> to behave. Secrets tell it <em>who it is</em>. Those are fundamentally different concerns.</p><p><strong>Identity replaces secrets wherever possible.</strong> Managed Identity for Key Vault access, OIDC for CI/CD authentication, Entra ID for database connections. Each identity-based authentication eliminates a secret that would otherwise require management. The best secret is the one that doesn&rsquo;t exist.</p><p><strong>Access must be explicit and auditable.</strong> Every system and person that can retrieve secrets must be explicitly authorized through RBAC. Every access must generate an audit event. When an auditor asks &ldquo;who accessed this secret in the last 90 days,&rdquo; you need an answer—not a shrug.</p><p><strong>Rotation must be procedural, not heroic.</strong> When rotation depends on someone remembering to update a secret, it won&rsquo;t happen reliably. Automated rotation for supported services. Monitoring and alerting for everything else. The goal is systems that fail safely when secrets expire, not systems that depend on human vigilance.</p><p>The teams that get this right aren&rsquo;t necessarily more security-conscious than others. They&rsquo;re the ones who understood that ISO 27017 controls exist for practical reasons—they codify lessons from decades of security failures into engineering requirements.</p><p>Your <code>appsettings.Production.json</code> file shouldn&rsquo;t contain secrets. Not because it&rsquo;s a best practice. Not because some security checklist told you so. Because ISO 27017 controls CLD 10.1.2, A.10.1.1, and A.10.1.2 require cryptographic key protection that configuration files simply cannot provide.</p><p>Azure Key Vault, Managed Identity, and proper access controls aren&rsquo;t optional security enhancements. They&rsquo;re the minimum viable implementation of international compliance standards that your organization probably already claims to follow.</p><p>The shared responsibility model is clear: Microsoft secures the vault. You secure the access. Neither works without the other.</p></section><section class="giscus"><h2>Comments</h2><aside class="giscus" id="giscus-thread" role="region" aria-label="Comments"></aside></section><script src="https://giscus.app/client.js" data-repo="dailydevops/dailydevops.github.io" data-repo-id="R_kgDOHA8eFg" data-category="Announcements" data-category-id="DIC_kwDOHA8eFs4COIqL" data-mapping="pathname" data-strict="1" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" async></script></article><aside class="sidebar divider"><section class="sidecar info" aria-labelledby="info-heading"><header><h2 id="info-heading" class="sr-only">Informations</h2></header><ul role="list"><li role="listitem"><time datetime="2026-02-03T17:00:00+01:00" itemprop="datePublished">Published on 2/3/26 5:00 pm</time></li><li>Read in 11 minutes</li></ul></section><section class="sidecar series" aria-labelledby="series-heading"><header><h2 id="series-heading">Series content</h2></header><nav class="series-nav" role="navigation" aria-label="Series content"><ul role="list"><li role="listitem"><a href="https://daily-devops.net/posts/secrets-management-azure-keyvault/" title="Your appsettings.json Is a Compliance Violation" target="_blank" rel="noopener external noreferrer"><i class="fas fa-angles-right" aria-hidden="true"></i>&nbsp;
Your appsettings.json Is a Compliance Violation</a></li><li role="listitem"><a href="https://daily-devops.net/posts/cryptography-dotnet-data-protection/" title="Your Encryption Is Broken — .NET Data Protection Done Right" target="_blank" rel="noopener external noreferrer"><i class="fas fa-angles-right" aria-hidden="true"></i>&nbsp;
Your Encryption Is Broken — .NET Data Protection Done Right</a></li></ul></nav></section><section class="sidecar author" aria-labelledby="author-martin-st%C3%BChmer"><header><h2 id="author-martin-st%C3%BChmer"><a href="/authors/martin/" rel="author" title="Martin Stühmer" itemprop="url">Author <span itemprop="name">Martin Stühmer</span></a></h2></header><figure class="round"><picture><img src="https://www.gravatar.com/avatar/6da4a47ff9cc2b750452225fdb2582f7?d=identicon&amp;s=200" alt="Martin Stühmer" loading="lazy" decoding="async" title="Martin Stühmer"></picture></figure><section class="content" itemprop="description">CTO at Integrated Worlds building cloud-native solutions on Azure with modern .NET. Nearly 20 years in .NET from Framework 2.0 to today. Microsoft Certified Trainer, former CGI Director, open-source maintainer. I’ve made every mistake, bet on dead technologies, and learned more from failures than successes. Quality isn’t optional, buzzwords don’t ship features, and experience means knowing what to avoid.</section><a class="link" href="/authors/martin/" rel="author" aria-label="Author Martin Stühmer: Read more"></a></section><section class="sidecar social" aria-labelledby="social-heading"><header><h2 id="social-heading">Social media</h2></header><nav class="social-nav" role="navigation" aria-label="Social media links"><a class="icon bluesky" href="https://bsky.app/profile/samtrion.net" rel="noopener external" aria-label="Follow me on Bluesky" target="_blank"><span class="fa-stack fa-fw fa-1x" aria-hidden="true"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-bluesky fa-stack-1x fa-inverse"></i>
</span></a><a class="icon github" href="https://github.com/samtrion" rel="noopener external" aria-label="Follow me on GitHub" target="_blank"><i class="fa-brands fa-fw fa-github fa-2x" aria-hidden="true"></i></a>
<a class="icon linkedin" href="https://www.linkedin.com/in/martin-stuehmer" rel="noopener external" aria-label="Follow me on LinkedIn" target="_blank"><span class="fa-stack fa-fw fa-1x" aria-hidden="true"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
</span></a><a class="icon stackoverflow" href="https://stackoverflow.com/users/10574963" rel="noopener external" aria-label="Follow me on Stack Overflow" target="_blank"><span class="fa-stack fa-fw fa-1x" aria-hidden="true"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
</span></a><a class="icon mail" href="mailto:martin@daily-devops.net" aria-label="Contact me by e-mail" target="_blank"><span class="fa-stack fa-fw fa-1x" aria-hidden="true"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
</span></a><a class="icon feed" href="/authors/martin/feed.rss" aria-label="My RSS feed" target="_blank"><span class="fa-stack fa-fw fa-1x" aria-hidden="true"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></nav></section><section class="sidecar share" aria-labelledby="share-heading"><header><h2 id="share-heading">Share this content</h2></header><a class="icon linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fdaily-devops.net%2fposts%2fsecrets-management-azure-keyvault%2f&text=Your%20appsettings.json%20Is%20a%20Compliance%20Violation%20%26mdash%3b%20Daily%20DevOps%20%26%20.NET" target="_blank" rel="noopener external" aria-label="Share on LinkedIn" title="Share on LinkedIn" target="_blank"><i class="fa-brands fa-fw fa-linkedin-in fa-2x"></i></a>
<a class="icon bluesky" href="https://bsky.app/intent/compose?text=Your%20appsettings.json%20Is%20a%20Compliance%20Violation%20%26mdash%3b%20Daily%20DevOps%20%26%20.NET%20https%3a%2f%2fdaily-devops.net%2fposts%2fsecrets-management-azure-keyvault%2f" target="_blank" rel="noopener external" aria-label="Share on Bluesky" title="Share on Bluesky" target="_blank"><i class="fa-brands fa-fw fa-bluesky fa-2x"></i></a></section><section class="sidecar tags" aria-labelledby="tags-heading"><header><h2 id="tags-heading">Tags</h2></header><ul class="tags" role="list"><li class="tag" role="listitem"><a href="/tags/dotnet/" hreflang="en" rel="tag" title=".NET" aria-label=".NET tag"><i class="fas fa-tag" aria-hidden="true"></i>&nbsp;.NET</a></li><li class="tag" role="listitem"><a href="/tags/azure/" hreflang="en" rel="tag" title="Azure" aria-label="Azure tag"><i class="fas fa-tag" aria-hidden="true"></i>&nbsp;Azure</a></li><li class="tag" role="listitem"><a href="/tags/cloud/" hreflang="en" rel="tag" title="Cloud" aria-label="Cloud tag"><i class="fas fa-tag" aria-hidden="true"></i>&nbsp;Cloud</a></li><li class="tag" role="listitem"><a href="/tags/iso-standards/" hreflang="en" rel="tag" title="ISO Standards" aria-label="ISO Standards tag"><i class="fas fa-tag" aria-hidden="true"></i>&nbsp;ISO Standards</a></li><li class="tag" role="listitem"><a href="/tags/security/" hreflang="en" rel="tag" title="Security" aria-label="Security tag"><i class="fas fa-tag" aria-hidden="true"></i>&nbsp;Security</a></li></ul></section><section class="sidecar related" aria-labelledby="related-heading"><header><h2 id="related-heading">Related content</h2></header><article class="post"><figure class="square"><picture><source srcset="/images/observability-80x80.webp?v=e029eb3d74e4d67f04990ad14af8ed68" type="image/webp"><source srcset="/images/observability-80x80.png?v=53f54ab518d5253040a9c4eff2a6b8ff" type="image/png"><img src="/images/observability.png?v=48acbd668436dc9dd3287b4ec5564639" alt="Audit Logging That Survives Your Next Security Incident" loading="lazy" decoding="async" title="Audit Logging That Survives Your Next Security Incident"></picture></figure><header><h2><a href="/posts/audit-logging-azure-app-insights/" rel="bookmark">Audit Logging That Survives Your Next Security Incident</a></h2></header><section class="content" role="region">Your audit logs probably won&rsquo;t survive a real security incident. Most implementations log too much, protect too little, and provide zero value when something breaks at 2 AM. Here&rsquo;s how to fix that with structured logging that actually works.</section></article><article class="post"><figure class="square"><picture><source srcset="/images/security-80x80.webp?v=35f82cde59317b992b40db6eee90c415" type="image/webp"><source srcset="/images/security-80x80.png?v=6b7b9203a90fa2d6df665509ee32b1e2" type="image/png"><img src="/images/security.png?v=530c4f0b5995d08df3450423fd03c5e0" alt="Why ISO Standards Actually Matter for .NET Developers" loading="lazy" decoding="async" title="Why ISO Standards Actually Matter for .NET Developers"></picture></figure><header><h2><a href="/posts/iso-standards-intro-dotnet-developers/" rel="bookmark">Why ISO Standards Actually Matter for .NET Developers</a></h2></header><section class="content" role="region">Cloud-native .NET development has transformed ISO/IEC 27001, 27017, and 27701 from abstract compliance requirements into concrete daily coding decisions. This guide shows .NET developers how security standards directly map to Azure Key Vault integration, Azure AD authentication, and proper logging—with real code examples demonstrating compliant vs. non-compliant implementations.</section></article><article class="post"><figure class="square"><picture><source srcset="/images/security-80x80.webp?v=35f82cde59317b992b40db6eee90c415" type="image/webp"><source srcset="/images/security-80x80.png?v=6b7b9203a90fa2d6df665509ee32b1e2" type="image/png"><img src="/images/security.png?v=530c4f0b5995d08df3450423fd03c5e0" alt="Your [Authorize] Attribute Is Compliance Theater
" loading="lazy" decoding="async" title="Your [Authorize] Attribute Is Compliance Theater
"></picture></figure><header><h2><a href="/posts/access-control-aspnet-core/" rel="bookmark">Your [Authorize] Attribute Is Compliance Theater</a></h2></header><section class="content" role="region"><p><strong>Your <code>[Authorize]</code> attributes give you a false sense of security. ISO 27001 auditors see right through it.</strong></p><p>I&rsquo;ve reviewed dozens of ASP.NET Core apps that authenticate flawlessly — then scatter role strings across business logic, skip audit logs, and wonder why they fail compliance. Here&rsquo;s the pattern that kills audits, and how to actually fix it.</p></section></article></section></aside><nav class="pager" aria-label="Article navigation" role="navigation"><a class="next" href="/posts/storage-architecture-stateful-workloads-aks/" rel="next" aria-label="Next: Storage Architecture & Stateful Workloads in AKS"><span class="sub"><i class="fas fa-backward" aria-hidden="true"></i>&emsp;<span class="sr-only">Next</span></span><p class="title">Storage Architecture & Stateful Workloads in AKS</p></a><a class="prev" href="/posts/audit-logging-azure-app-insights/" rel="prev" aria-label="Previous: Audit Logging That Survives Your Next Security Incident"><span class="sub"><span class="sr-only">Previous</span>&emsp;<i class="fas fa-forward" aria-hidden="true"></i></span><p class="title">Audit Logging That Survives Your Next Security Incident</p></a></nav></main><footer class="footer"><div class="divider"></div><nav><ul class="navigation"><li><a href="/tags/">Tags</a></li><li><a href="/legal-notice/">Legal notice</a></li></ul></nav><div class="copyright">&copy; 2023 - 2026 Daily DevOps & .NET</div></footer><script defer src="/js/below.min.a6ce9164454b6077f17ae856f280442d9f3a1e21f06189f71c21f75144b22a0c8cf32bafd61d440e9d90ca02bf738b6a8ef19f5ec20285d8ca574f98c91ebaf2.js" integrity="sha512-ps6RZEVLYHfxeuhW8oBELZ86HiHwYYn3HCH3UUSyKgyM8yuv1h1EDp2QygK/c4tqjvGfXsIChdjKV0+YyR668g==" crossorigin="anonymous"></script><img class="vgwort" src="https://vg05.met.vgwort.de/na/f906b3faf6c84330b9850912d9c0d33a" width="1" height="1" alt="VG Wort" title="VG Wort"></body></html>